%\documentclass{emulateapj}
\documentclass[letterpaper,12pt,preprint]{aastex}

% packages
\usepackage{amssymb,amsmath, amsbsy}
\usepackage{booktabs}

% commands
\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\gaia}{\project{Gaia}~}
\newcommand{\spitzer}{\project{Spitzer}~}
\newcommand{\given}{\,|\,}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\transpose}[1]{{#1}^{\mathsf{T}}}
\newcommand{\inverse}[1]{{#1}^{-1}}
\newcommand{\jac}[1]{\left\vert \J{#1} \right\vert}

\newcommand{\D}{{\bf D}}
\newcommand{\W}{{\bf W}}
\newcommand{\X}{{\bf X}}
\newcommand{\J}{{\boldsymbol J}}
\newcommand{\bSigma}{{\bf \Sigma}}
\newcommand{\bsigma}{\boldsymbol\sigma}
\newcommand{\rtide}{r_{\rm tide}}

\newcommand{\bsr}{\boldsymbol r}
\newcommand{\bsv}{\boldsymbol v}

\newcommand{\paperone}{Paper 1}

\begin{document}

\title{Inferring the gravitational potential of the Milky Way with a few precisely measured stars}
\author{Adrian M. Price-Whelan, David W. Hogg, Kathryn V. Johnston, [TODO: order?]}

\begin{abstract}
Context:
Aims: 
Methods:
Results:
Conclusions:

%Informative phase-space structures, and in particular those created by
%disrupting stellar systems or revealed by chemical tags, may deliver
%very precise measures of the gravitational potential in the Milky Way
%Halo.  Here we show that even a single pair of stars---two stars that
%are known (for some non-kinematic reason) to be likely to be
%associated with one another at birth---could provide a significant
%constraint on the potential.  The inference is based on a
%probabilistic generative model---a likelihood function and priors over
%nuisance parameters---that evolves a past putative origin disruption
%event forward in time to the present day.  The time, six-volume, and
%phase-space location of the origin event are nuisance parameters in
%the model and marginalized away.  The method makes no assumption of
%integrability, works with finite or even large observational
%uncertainties, does not require all dimensions of phase space to be
%observed, handles non-zero probability that the two stars are not in
%fact associated, and generalizes naturally to larger numbers of stars
%and multiple independent structures.  Applications to the GD-1 cold
%stellar stream and current surveys for RR Lyrae stars in the Halo are
%discussed.
TODO...
\end{abstract}

\keywords{
  cosmology: dark matter
  ---
  Galaxy: structure
  ---
  Galaxy: halo
}

\section{Introduction}

Cosmological simulations of galaxy formation in the $\Lambda$CDM paradigm predict dark matter halos that (1) are permeated with substructure on many scales, (2) are triaxial in shape, and (3) have density profiles and shapes that vary with radius \citep{dubinski91, jing02, kuhlen07, veraciro11}. Dark-matter-only simulations seem to produce strongly triaxial halos, but including baryons tends to soften the triaxiality in the inner galaxy [through a combination of adiabatic contraction and energetic feedback \citep[see recent discussion by][]{pontzen12} TODO: modify previous sentence bc in PW\&J 2013]. These [...] may lead to radially-dependent axis ratios, halo orientation, and density profiles.

The bulk of the baryonic matter in galaxies spans roughly 5-10\% of the extent of the host dark matter halo. Hence, the major components of a galaxy are sensitive to the inner portion of its host halo's mass distribution. For example, the rotation curves of disk galaxies are particularly sensitive probes of the inner mass since matter in disks can be assumed to move on near circular orbits. This extra knowledge about the orbital distribution of the baryonic matter within a disk allows a more precise tracing of the potential than is feasible for objects such as elliptical galaxies where orbits are assumed to be random. [Potential is most likely smoothed out (energetic feedback), can approximate as closely integrable allowing beautiful dynamical methods ...]

Conversely, measuring the dark matter distribution at large radii is difficult as the density of visible tracers becomes small. Around external galaxies, the extended mass distribution has been explored using a variety of approaches \citep[see][for a a complete and detailed review]{courteau12}. For example, the kinematics of tracer populations such as globular clusters or planetary nebulae can be used to derive mass estimates under the assumptions that these satellite systems are relaxed and well-mixed \citep[early investigations include][]{mendez01,cote03}. These estimates are necessarily limited by the number of objects bright enough for spectroscopic measurements and thus the largest samples to date have roughly several hundred members probing out to several 10's of kpc. Simple, parameterized models of both the mass and orbit distribution have been simultaneously constrained using such data \citep[e.g.][]{napolitano11,deason12a}. 
%\citep{romanowsky03,douglas07,romanowsky09,napolitano11,lee11}
Alternatively, the statistical properties of gravitationally lensed background sources around a galaxy can be used to constrain the \emph{projected} shape, orientation, and radial profile of mass \citep[as done by the Lens Structure and Dynamics Survey described in][]{koopmans02}. Of course, lensing reconstructions can only be performed for galaxies which closely intersect our line of sight to background sources, but the advent of large photometric catalogues has allowed automatic searches for such chance alignments and significant increases in the number of objects studied in this way \citep[e.g. the Sloan Lens ACS Survey, see][]{bolton06}.

Within the Milky Way we have a unique vantage point that allows us to measure the three-dimensional structure of our own dark matter halo. One approach to ... [explain ``random'' methods: kinematic tracers]. Another approach is to exploit the non-random nature of the stellar populations in the halo. A consequence of hierarchical structure formation [...] and such structures have been observed [e.g., ...cite belokurov?]. Tidal streams are dynamically cold systems --- debris typically have small distributions of energy and angular momentum --- and thus require orders of magnitude fewer tracers than a random sample to get constraints of comparable accuracy. For example, in the simplest case we might {\it assume} that debris stars are actually still on the same orbit as their progenitor system \citep[a \emph{wrong} assumption, see e.g.][]{eyre}. Then we can imagine measuring the full-space velocities ${\bf v}$ at different points ${\bf x}$ in the structure (e.g. along a stream), which would give us a direct measure of differences in a potential, $\Phi$. In practice, simple methods such as orbit fitting lead to systematic biases in inferred properties of the underlying potential because streams do not strictly delineate orbits [cite eyre binney work]. 

Since the initial discovery of tidal debris from Sgr, myriad other streams and debris systems have been discovered in large photometric surveys probing Galactocentric distances from $\sim$15-100 kpc. The known debris structures are $\gtrsim$10 kpc from the Sun, thus while overdensities in the halo are less contaminated by background, the constituent stars often have incomplete or poorly measured phase-space information. Perhaps the most rigorous method of modeling streams and the potential is to run full N-body simulations of satellite disruption and compare the density of observed stars to simulated stars. Such a model could naturally incorporate observational uncertainties, missing dimensions, and would, in principle, allow for studying any arbitrary time-dependent or non-integrable potential. However, such a model is presently computationally intractable [though see milkyway@home stuff...]. \cite{law10} ran several N-body models of the disruption of the Sagittarius (Sgr) dwarf spheroidal galaxy and qualitatively matched their simulated streams to all Sgr data available at that time. By comparing the phase-space positions of their stream particles with the data, they were able to use these simulations to constrain the shape of the Milky Way potential out to $\sim$70 kpc [check number] and found that the best-fitting halo has a peculiar triaxial shape elongated in the Galactic Z direction, orthogonal to the plane of the disk. (though, see ... for possible complications in the Sgr debris belokurov 2012?). 

The difficulty and computational costs associated with proper N-body modeling has motivated numerous efforts for developing approximate methods for constraining properties of the Galactic potential with cold debris structures. The simplest approximation is to fit a single orbit to observed debris \citep[e.g.,][]{koposov10, deg13}. This has the advantage of naturally incorporating observational errors, but is known to be invalid as debris does not exactly follow an orbit \citep[e.g.,][]{binney08, eyre11, sanders13a}. To account for this, methods have been proposed that model the debris as an orbit plus some dispersion or offset in phase space \citep[e.g.,][]{eyre09a, varghese11, kuepper12} or action-angle coordinates \citep{eyre11, sanders13b, bovy14}. Other statistical methods have been proposed \citep[][]{penarrubia12, sanderson14} that may prove powerful when applied to, e.g., data from the \gaia mission, where full 6D coordinates will be known for large samples of stars in the halo --- and therefore many debris structures --- but membership is not necessarily known. However, these methods do not account for observational errors.

Methods that rely on action-angle coordinates, [...]. Any generative model that relies on matching densities --- whether in phase-space, action-space, or observed coordinates --- must also include details about the progenitor and a model for the background of stars. [...] In \citet[][hereafter \paperone]{apw13}, we introduced a simple method for using individual stars combined with knowledge about the mass and orbit of the progenitor to constrain properties of the host galaxy potential (\emph{Rewinder}). [...]

- Then a short note on worries\\
\indent\indent- for generative models\\
\indent\indent- for any methods based on action/angle \\
\indent\indent- GD-1 was fit as if it highlighted an orbit.  That is known to be wrong.\\
\indent\indent- Densities are hard to match: need a background model, way to go from luminosity to density, needs assumptions about the mass function and structure of the satellite\\
\indent\indent- Triaxiality / radially-dependent shapes and substructure present problems for integral-based methods\\
- Then how rewinder gets round these????\\
\indent\indent- Reference Deg \& Widrow to say they illustrate the idea of the power of multiple streams to back up the bit where you say that's the long-term aim\\

[Another prediction of hierarchical structure formation in $\Lambda$CDM is the presence of substructure. ]

%[Chemical tagging will always only give probabilistic information.
%  But what if it delivers somewhat confident information about small
%  stellar families in the halo?]

[Actions, angles, integrable, not, etc.  Can integrate in any
  potential, even a time-varying one. We use this to
  ``run the clock back''.  Why is an objective based on past collisions not the
  same as assuming that the stars are on the same orbit?]

[Sometimes stellar samples might get extremely small.  For example,
  \gaia\ might find some very low-mass cold stellar streams.  For
  another, there might only be a couple RRL stars in a particular
  stream, but those RRL stars might be individually extremely well
  measured in six-space.]

[Even if you have many stars, some might be orders of magnitude more constraining (Bovy, ..., Hogg)]

[Cold vs. Hot streams in the context of observational errors]

[We properly handle observational errors]

\section{Simulations}\label{sec:sims}

We [...] N-body simulations run with an SCF code [...]. [KVJ: describe simulations here?]

\section{Method}

\subsection{Notation}
Take $\D$ to be the observed, heliocentric 6D position of a star --- e.g., the measured position on the sky, ($l$, $b$); distance, $D$; proper motions, ($\mu_l$, $\mu_b$); and line-of-sight velocity, $v_r$ --- and take $\W$ to be the corresponding \emph{true}, 6D position of the star in the same coordinate and reference frame. Assume that we have determined that this star was once part of a progenitor system (e.g., satellite galaxy) tidally disrupting and forming a cold debris structure in the potential, $\Phi$, of some parent galaxy. The position of the progenitor is observed to be at heliocentric 6D position $\D_p$, with true position $\W_p$ (where any subscript $p$ refers to the progenitor). The true 6D heliocentric spherical positions of the star and progenitor -- $\W$ and $\W_p$ -- have corresponding 6D Galactocentric cartesian coordinate vectors $\X$ and $\X_p$ comprised of 3D position and velocity vectors ($\bsr$,$\bsv$) and ($\bsr_p$,$\bsv_p$). Initially we assume the present-day mass of the progenitor, $M_p$, and velocity dispersion, $\sigma_v$, have been measured perfectly and neglect mass-loss from the progenitor. 

\subsection{Motivation}
In \cite{apw13}, we introduced the \emph{Rewinder} algorithm [...]. In that work, we define a phase-space distance, $D_{ps}$, as the sum of the normalized, relative position, $\frac{\bsr-\bsr_p}{\rtide}$, and velocity, $\frac{\bsv-\bsv_p}{v_{\rm esc}}$, for a stream star. We minimized the generalized variance of the 6D distribution over each normalized coordinate evaluated at the time that each star has minimum $D_ps$. This simple idea proved quite powerful for constraining properties of the LM10 potential used simulated observations of their N-body simulation. However, this method does not properly incorporate observational uncertainties. 

Using the simulations described in Section~\ref{sec:sims}

\begin{figure}[h]
\begin{center}
%\includegraphics[width=0.45\textwidth]{fig4.eps}
\includegraphics[width=\textwidth]{/Users/adrian/projects/streams/plots/paper2/rel_dists.pdf}
\caption{ TODO }\label{fig:reldist}
\end{center}
\end{figure}

%The core of this method provides a basis for the probabilistic model presented below. 

\subsection{Probabilistic model}
With this notation, we write the joint posterior probability for the observed position of a star, progenitor, and parent potential parameters as:
\begin{align}
	p(\Phi, \W, \W_p, \tau \given \D, \D_p) &= \frac{1}{\mathcal{Z}} p(\D \given \W) p(\D_p \given \W_p) 
												       p(\W \given \W_p, \tau, \Phi) 
												       p(\Phi) p(\tau)
\end{align}
where the factor $\mathcal{Z}$ only depends on the properties of the data (the \emph{evidence}), and is thus constant when varying the model parameters. We assume that the observational errors are Gaussian in heliocentric coordinates:
\begin{align}
	p(\D \given \W) &= \mathcal{N}(\W \given \D, \bSigma)\\
	p(\D_p \given \W_p) &= \mathcal{N}(\W_p \given \D_p, \bSigma_p)
\end{align}
where the covariance matrices $\bSigma$ and $\bSigma_p$ specify the observational uncertainties on the observed 6D position of star and the progenitor, respectively. 

The disruption of a satellite galaxy due to tidal shocking [...connect to Choi work some how?] We model the present-day position and velocity of a disrupted star as the result of sampling from isotropic, log-normal distributions in relative distance, $R=\left\vert \bsr-\bsr_p \right\vert$, and relative velocity, $V=\left\vert \bsv-\bsv_p \right\vert$, at the time the star comes unbound from the progenitor, evolved to present day in the parent potential, $\Phi$. The distributions over $\ln R$ and $\ln V$ are centered on the logarithm of the instantaneous tidal radius, $\rtide$, and velocity dispersion, $\sigma_v$, of the progenitor at time $\tau$: $\mathcal{N}(\ln R \given \ln\rtide)\vert_{t=\tau}$ and $\mathcal{N}(\ln V \given \ln \sigma_v)\vert_{t=\tau}$. In this model, we neglect the effect of self-interaction with the halo of the progenitor. 

The likelihood of a star's position today is computed by first transforming the observed position to Galactocentric cartesian coordinates and integrating the orbits of the progenitor and star backwards for several Gigayears in the parent potential, $\Phi$, treating both as test particles. The distance, $R$, and velocity, $V$, of the star relative to the progenitor are computed at each time-step, and the likelihood is computed as the product of the isotropic, log-normal centered on the logarithm of the instantaneous tidal radius with the isotropic, log-normal centered on the logarithm of the velocity dispersion of the progenitor:
\begin{align}
	p(\W \given \W_p, \tau, \Phi) &= p(\X \given \X_p, \tau, \Phi) \jac{(l,b,D,\mu_l,\mu_b,v_r)}_{t=\tau}\\
	p(\X \given \X_p, \tau, \Phi) &= p(\ln R, \ln V \given \tau, \Phi) \jac{(x,y,z,v_x,v_y,v_z)}_{t=\tau}\label{eq:int} \\
	p(\ln R, \ln V \given \tau, \Phi) &= \left[\mathcal{N}(\ln R | \ln \rtide, \sigma_R)\mathcal{N}(\ln V | \ln \sigma_v, \sigma_V)\right]_{t=\tau}
\end{align}
% , but the vectors $\D$ and $\W$ [exist] in different coordinate systems --- heliocentric spherical and Galactocentric cartesian, respectively --- so we must also track the Jacobian that [describes] this transformation:
where in eq.~\ref{eq:int} we have implicitly integrated over and neglected the two angle coordinates associated with $\ln R$ and the two angles associated with $\ln V$. 
\begin{align}
	\ln p(\ln R, \ln V \given \tau, \Phi) = -\ln(2\pi)-\ln(\sigma_R\sigma_V)-
		\ln\left[\left(\frac{R}{\rtide}\right)^{1/\sigma_R} \left(\frac{V}{\sigma_v}\right)^{1/\sigma_V}\right]
\end{align}
We then compute the marginal likelihood, $p(\W \given \W_p, \Phi)$, by integrating over all possible unbinding times,
\begin{align}
	p(\W \given \W_p, \Phi) = \int p(\W \given \W_p, \tau, \Phi)p(\tau) d\tau.
\end{align}
In general, $p(\tau)$ is likely conditional on the orbit of the progenitor --- stars are preferentially stripped at pericentric passages --- but this is neglected and is taken to be uniform over the entire interaction history between the progenitor and parent. 

\section{Experiments}

For all tests in this article, we model the potential of the parent galaxy as a three-component sum of a Miyamoto-Nagai disk \citep{}, Hernquist bulge \citep[spheroid;][]{}, and a triaxial, logarithmic halo \citep[e.g.,][]{law10}:
\begin{align}
	&\Phi_{\rm disk}(R,z) = -\frac{GM_{\rm disk}}{\sqrt{R^2 + (a + \sqrt{z^2 + b^2})^2}}\\
	&\Phi_{\rm spher}(r) = -\frac{GM_{\rm spher}}{r + c}\\
	&\Phi_{halo}(x,y,z) = v_{h}^2 \ln(C_1 x^2 + C_2 y^2 + C_3 xy + (z/q_z)^2 + r_h^2)
\end{align}
where $C_1$, $C_2$, and $C_3$ are combinations of the $x$ and $y$ axis
ratios ($q_1$, $q_2$) and orientation of the halo with respect to the
baryonic disk ($\phi$):
\begin{align}
  C_1 &= \frac{\cos^2\phi}{q_1^2} + \frac{\sin^2\phi}{q_2^2}\\
  C_2 &= \frac{\sin^2\phi}{q_1^2} + \frac{\cos^2\phi}{q_2^2}\\
  C_3 &= 2\sin\phi\cos\phi \left(q_1^{-2} - q_2^{-2}\right).
\end{align}

\begin{figure}[h]
\begin{center}
%\includegraphics[width=0.45\textwidth]{fig4.eps}
\includegraphics[width=\textwidth]{/Users/adrian/projects/streams/plots/paper2/potentials.pdf}
\caption{ TODO }\label{fig:potential}
\end{center}
\end{figure}

When recovering the potential, we hold fixed the disk and spheroid parameters (see Table~\ref{tbl:potential}), along with two halo parameters: the scale radius, $r_h$, and one of the flattening components in the x-y plane, $q_2$. These halo parameters are degenerate with combinations of the other parameters --- e.g., setting $q_1=2.0$, $q_2=1.0$, $\phi=0^\circ$ is equivalent to setting $q_1=1.0$, $q_2=2.0$, $\phi=90^\circ$. The priors on the remaining halo parameters are taken to be uniform over a conservative domain of realistic values: for $v_h$, 100-200~kms$^{-1}$ corresponds to a range in solar circular velocities from $\sim$210-250 kms$^{-1}$ (holding other parameters fixed); the range in axis ratios allow for prolate, oblate, and mixed triaxiality; and $\phi$ is restricted to $\pm45^\circ$ around the value measured by LM10 ($\phi = 97^\circ$). Figure~\ref{fig:potential} shows equipotential slices in the Galactic X-Z plane (Y=0) and Y-Z plane (X=0) for a few choices of  $q_1$,  $q_z$, and $\phi$ while holding all other parameters fixed, as described in the figure caption.

\begin{table}[h]
\begin{center}
	\begin{tabular}{l c c c} \toprule
		{\bf Component} & {\bf Parameter} & {\bf Value} & {\bf Prior} \\\toprule
		disk & $M_{\rm disk}$ & $1.0\times10^{11}M_\odot$ & -- \\ 
		& $a$ & 6.5 kpc & --\\
		& $b$ & 0.26 kpc & --\\
		\midrule
		spheroid & $M_{\rm spher}$ & $3.4\times10^{10}M_\odot$ & --\\ 
		& $c$ & 0.7 kpc & --\\
		\midrule
		halo & $v_h$ & -- & $\mathcal{U}(100,200)$ km $\mathrm{s}^{-1}$ \\
		& $q_1$ & -- & $\mathcal{U}(1,2)$\\
		& $q_2$ & 1.0 & --\\
		& $q_z$ & -- & $\mathcal{U}(1,2)$\\
		& $\phi$ & -- & $\mathcal{U}(52,142)$ deg\\
		& $r_h$ & 12 kpc & --\\
		\bottomrule
		\hline
	\end{tabular}
	\caption{Parameter values used ...\label{tbl:potential}}
\end{center}
\end{table}

\subsection{\gaia + \spitzer}
4 stars in Sgr-like stream

\subsection{\spitzer + current data}
4 stars in Sgr-like stream

\subsection{\spitzer + current data, no progenitor}
4 stars in Orphan-like stream, XX stars in GD-1 -like stream

\section{Discussion}

[Cold vs. Hot streams]

[bow-tie structure, Kuepper work, and so on]

[What's unrealistic about what we have done?  The kinematic model of
  the progenitor is exceedingly simplistic; why are we okay with it
  nonetheless but what could we do to improve it?  Related to this,
  the progenitor doesn't shrink with time (as it should).  What's up
  with that?]

[We did not assume the potential is static in time.  At least not in
  general; nothing in the method requires or suggests this.]

[Issues about computation and scaling.]

[Nothing special about streams; will work on any structures, including
  shells and the like.]

[Don't eschew low-dimensional constraints on the potential!]

\bibliographystyle{apj}
\bibliography{refs}

\acknowledgements


\end{document}
