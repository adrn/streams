%\documentclass{emulateapj}
\documentclass[letterpaper,12pt,preprint]{aastex}

% packages
\usepackage{amssymb,amsmath, amsbsy}
\usepackage{booktabs}
\usepackage[caption=false]{subfig}

% commands
\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\gaia}{\project{Gaia}}
\newcommand{\spitzer}{\project{Spitzer}~}
\newcommand{\given}{\,|\,}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\transpose}[1]{{#1}^{\mathsf{T}}}
\newcommand{\inverse}[1]{{#1}^{-1}}
%\newcommand{\project}[1]{{\sffamily #1}}

\newcommand{\D}{{\bf D}}
\newcommand{\W}{{\bf W}}
\newcommand{\X}{{\bf X}}
\newcommand{\J}{{\boldsymbol J}}
\newcommand{\bSigma}{{\bf \Sigma}}
\newcommand{\bsigma}{\boldsymbol\sigma}
\newcommand{\rtide}{r_{\rm tide}}
\newcommand{\bs}{\boldsymbol}
\newcommand{\sat}{{\rm p}}
\newcommand{\tub}{t_{\rm ub}}
\newcommand{\tint}{t_{\rm int}}
\newcommand{\rr}{\widetilde{\bs{r}}}
\newcommand{\vv}{\widetilde{\bs{v}}}
\newcommand{\tailbit}{\beta}
\newcommand{\Loffset}{\alpha}
\newcommand{\pshock}{P_{\rm shock}}
\newcommand{\paperone}{Paper 1}
\newcommand{\vhalo}{v_{\rm h}}
\newcommand{\rewinder}{\emph{Rewinder}}
\newcommand{\potp}{$q_1,q_z,\phi,\vhalo$}

\begin{document}

\title{Inferring the gravitational potential of the Milky Way with a few precisely measured stars}
\author{Adrian M. Price-Whelan\altaffilmark{\colum,\adrn}, 
	    David W. Hogg\altaffilmark{\nyu,\mpia}, 
	    Kathryn V. Johnston\altaffilmark{\colum}, 
	    David Hendel\altaffilmark{\colum}}

% Affiliations
\newcommand{\colum}{1}
\newcommand{\adrn}{2}
\newcommand{\nyu}{3}
\newcommand{\mpia}{4}
\altaffiltext{\colum}{Department of Astronomy, 
		              Columbia University, 
		              550 W 120th St., 
		              New York, NY 10027, USA}
\altaffiltext{\adrn}{To whom correspondence should be addressed: adrn@astro.columbia.edu}
\altaffiltext{\nyu}{Center for Cosmology and Particle Physics,
                      Department of Physics, New York University,
                      4 Washington Place, New York, NY, 10003, USA}
\altaffiltext{\mpia}{Max-Planck-Institut f\"ur Astronomie,
                     K\"onigstuhl 17, D-69117 Heidelberg, Germany}

\begin{abstract}
% Context
The dark-matter halo of the Milky Way is expected to be triaxial on large scales
  and filled with substructure.
It is hoped that streams or shells of stars produced by tidal disruption
  will provide very precise measures of the gravitational potential,
  to test these predictions.
% Aims
We develop a justified method for inferring the gravitational potential
  using precise measurements of stars in tidal streams
  based on an approximate generative model.
Our method does not rely on integrability of the potential;
  we do not know that any good approximation to the large-scale 
  Milky Way potential is integrable.
% Methods: 
Our model is probabilistic, with a likelihood function and priors on the parameters.
It is based on the idea that the stars in a tidal structure
  were close in phase space at some point in the past.
  Model parameters include the present-day phase-space position for each star
  and the progenitor, and thus properly accounts for finite observational uncertainties 
  and missing data.
This method is new in that it makes no assumption about the form of the Milky Way 
  potential, accounts properly for observational uncertainties, and allows for missing data
  dimensions.
We test our method with simulated data in a non-integrable triaxial potential, with realistic 
  observational uncertainties for RR Lyrae stars.
Importantly, the fake data were generated with an n-body simulation,
  not with the approximate model underlying our likelihood function.
% Results:
We find that even with a small number (8 to 16) of well-measured stream stars,
  we can precisely infer properties of the triaxial potential,
  missing phase-space coordinates of the stars,
  and the location of the progenitor object.
The method generalizes to encompass mixtures of independent debris structures,
  or situations in which star membership in structures is unknown.
% [Get more quantitative here?]
% Conclusions: 
\end{abstract}

\keywords{
  cosmology: dark matter
  ---
  Galaxy: structure
  ---
  Galaxy: halo
}

\section{Introduction}

Early large-scale, cosmological simulations of galaxy formation in the $\Lambda$CDM paradigm suggested that the spherically-averaged density profiles of dark matter halos follow a universal profile across a large dynamic range in mass \citep{navarro96}. Since then, higher resolution simulations --- both with and without baryons --- have produced dark matter halos that (1) are permeated with substructure on many scales, (2) are triaxial in shape, and (3) have shapes and orientations that vary with radius \citep{dubinski91, jing02, kuhlen07, veraciro11}. Dark-matter-only simulations produce triaxial halos \citep{jing02} with large density fluctuations \citep{zemp09}. Inclusion of baryons tends to soften the triaxiality and graininess in the inner galaxy through a combination of dissipative infall \citep{dubinski94} or cooling \citep{bryan13}. These processes combined with the gravity from a baryonic disk or ellipsoid can act to make the inner halo more oblate or spherical, however they do not seem to erase the clumpy, triaxial nature of the outer halo \citep[e.g.,][]{pontzen12}. This can lead to radially-dependent axis ratios, orientation, and smoothness, thus suggesting that the true mass distributions around Milky Way-like galaxies are not easily represented by integrable potentials.

The bulk of the baryonic matter in galaxies spans roughly 5-10\% of the extent of the host dark matter halo. Hence, the most observable components of a galaxy are sensitive to the inner portion of the host halos mass distribution. For example, the rotation curves of disk galaxies trace the inner mass, especially since matter in disks can be assumed to move on nearly circular orbits. Conversely, measurements of the dark matter distribution at large radii is complicated by the low density of visible tracers, observational difficulties, and assumptions about the smoothness and analytic form. Around external galaxies, the extended mass distribution has been studied using a variety of approaches \citep[see][for a a complete and detailed review]{courteau13}. For example, the kinematics of tracer populations such as globular clusters or planetary nebulae can be used to derive mass estimates under the assumptions that these satellite systems are relaxed and well-mixed \citep[early investigations include][]{mendez01,cote03}. Simple, parameterized models of both the mass and orbit distribution have been simultaneously constrained using such data \citep[e.g.][]{napolitano11,deason12c}. 
%\citep{romanowsky03,douglas07,romanowsky09,napolitano11,lee11}
Alternatively, the statistical properties of gravitationally lensed background sources around a galaxy can be used to constrain the \emph{projected} shape, orientation, and radial profile of mass \citep[see, for example, the Lens Structure and Dynamics Survey described in][]{koopmans02}. Of course, lensing reconstructions can only be performed for galaxies which closely intersect our line of sight to background sources, but the advent of large photometric catalogues has allowed automatic searches for such chance alignments and significant increases in the number of objects studied in this way \citep[e.g. the Sloan Lens ACS Survey, see][]{bolton06}.

Within the Milky Way our unique vantage point allows us a three-dimensional view of the structure in own dark matter halo. Our proximity allows us to use individual stars as kinematic tracers and hence build much larger samples that probe deeper into the halo than the globular cluster and planetary nebula studies of external galaxies. For example, \cite{deason12a} used halo BHB stars selected from the Sloan Digital Sky Survey \cite[SDSS;][]{york00} as a random tracer population to measure the mass and slope of a power-law fit. Such studies assume that the tracer orbits are randomly sampled from a smooth distribution function and are fully phase mixed. However, large photometric surveys such as the SDSS have discovered large amounts of substructure --- in streams and associations of stars --- in the Milky Way halo, thus demonstrating that the stellar distribution is not phase-mixed. Since the initial discovery of tidal debris from the Sagittarius (Sgr) dwarf spheroidal galaxy, myriad other streams and debris systems have been identified probing Galactocentric distances from $\sim$15-100 kpc. The existence of large-scale substructure in stellar streams and clouds is known to bias mass and velocity inferences by several tens of percent \citep{yencho06}.

Another approach to using halo stars as potential measures is to exploit the non-random nature of halo. For example, \citet[][LM10]{law10} used n-body simulations of the disruption of the Sgr dwarf to simultaneously model the debris and underlying Milky Way potential. By varying parameters of the Milky Way potential, they found ``best-fit'' parameters by comparing the properties of observed Sgr stars to their simulated debris over a grid of potential parameters. The computational costs of running n-body simulations limited their search to a grid of values and forced the authors to fix many other parameters (e.g., properties of the disk and bulge). Nevertheless, they were able to constrain the shape of the Milky Way potential out to $\sim$70 kpc and found that the best-fitting halo has a prolate, triaxial shape elongated in the Galactic Z direction, orthogonal to the plane of the disk. Though an unlikely orientation for the halo --- e.g., \cite{debattista13} find that the disk of the Milky Way would not remain stable in such a configuration --- LM10 showed that the data is at a state where such inference can be attempted. The computational costs associated with n-body modeling has motivated many methods that approximately model tidal streams.

Tidal streams are dynamically cold systems --- debris typically have small distributions of energy and angular momentum --- and thus require orders of magnitude fewer tracers than a random sample to get constraints of comparable accuracy to, e.g., Jeans analysis. For example, in the simplest case we might assume that debris stars are actually still on the same orbit as their progenitor system \citep[a \emph{wrong} assumption, see e.g.,][]{eyre11}. Then we can imagine measuring the full-space velocities ${\bf v}$ at different points ${\bf x}$ in the structure (e.g., along a stream), which would give us a direct measure of differences in a potential, $\Phi$, without running a full model of the disruption. An extension of this idea is to fit a single orbit to observed debris \citep[e.g.,][]{koposov10, deg13}. Though this is known to be incorrect and leads to biases in inferred properties of the underlying potential \citep[e.g.,][]{eyre11, lux13, sanders13a}, \cite{deg14} and \cite{lux13} have used orbit fitting to demonstrate the power of combining multiple streams in dynamical inference. To account for the offset between the orbit of the progenitor and the orbits of the debris stars, methods have been proposed that model the debris as an orbit plus some dispersion or offset, either in phase space \citep[e.g.,][]{eyre09a, varghese11, kuepper12} or action-angle coordinates \citep{eyre11, sanders13b, bovy14, sanders14}. We will \emph{not} assume that streams follow the orbit of the progenitor. Other statistical methods have been proposed \citep[][]{penarrubia12, apw13, sanderson14} that may prove powerful when applied to, e.g., data from the \gaia\, mission, where full 6D coordinates will be known for large samples of stars in the halo --- and therefore many debris structures --- but stream membership is not known for all stars.

We identify a number of problems with existing approximate models; each method mentioned above solves only a subset of these issues:
\begin{enumerate}
	\item The known debris structures are $\gtrsim$10 kpc from the Sun, thus while overdensities in the halo are less contaminated by background, the constituent stars often have incomplete or poorly measured phase-space information. Thus it is critical for any approximate model of tidal debris to incorporate observational uncertainties and missing dimensions in a consistent and justified way. 
	\item The potential of the inner galaxy is conceivably well-described by a (set of) nearly-integrable potentials, thus the dynamics of collisionless systems is plausibly captured by a transformation to some integral-of-motion-space, e.g., action-angle coordinates. However there is large uncertainty in the radial profile, shape, orientation, and graininess of the outer halo and the constancy of these parameters over distance. Properly describing the potential may require complex models where computing actions is non-trivial or even impossible.
	\item Near-future photometric surveys such as \gaia\, and the \project{LSST} will likely discover many new streams and kinematic associations of stars. Potential recovery methods should be able to simultaneously model multiple streams and incorporate other dynamical constraints.
	\item Matching generated models to observed stream densities is difficult: models that rely on this must account for observational biases and properly model the underlying background of halo stars. 
	\item Full N-body models are expensive to run. Incorporating an n-body model into a general model and then performing a parameter search would be computationally intensive and, presently, intractable. 
\end{enumerate}

%[][hereafter \paperone]
In \citet{apw13}, we introduced a simple method for using individual stars associated with tidal debris combined with knowledge about the mass and orbit of the progenitor to constrain properties of the host galaxy potential. The method exploits the relationship between the phase-space distribution of debris and (measurable) properties of the progenitor system (e.g., the tidal radius and escape velocity).  Specifically, a better model for the potential is one in which orbits of test particle stars (integrated backwards from their present position) came close (within the tidal radius in position, and escape velocity in velocity) to the orbit of the progenitor. In this article, we use these simple scalings --- which depend only on the mass and orbit of the progenitor and parent potential --- to present a fully probabilistic method (\rewinder) for modeling tidal streams in any underlying potential given data with realistic uncertainties. By ``model'' here we mean a justified, parametrized likelihood function with priors on the parameters. \rewinder\, relies on numerical orbit integration in ordinary phase-space and can thus incorporate arbitrarily complex models for the parent potential. Individual stars are used as constraints, thus \rewinder\, can handle very small samples of well-measured stars (e.g., 4-16). This model trivially extends to incorporating multiple streams, debris structures, and other kinematic information. 

In Section~\ref{sec:sims} we describe a suite of n-body simulations that span a range of progenitor masses on a characteristic, mildly eccentric orbit. In Section~\ref{sec:} we describe [...]

\section{Simulations}\label{sec:sims}
[David Hendel]
We [...] n-body simulations run with an SCF code [...]. [describe simulations here] [Describe tub]

The potential is taken to be a three-component sum of a Miyamoto-Nagai disk \citep{}, Hernquist bulge \citep[spheroid;][]{}, and a triaxial, logarithmic halo \citep[e.g.,][]{law10}:
\begin{align}
	&\Phi_{\rm disk}(R,z) = -\frac{GM_{\rm disk}}{\sqrt{R^2 + (a + \sqrt{z^2 + b^2})^2}}\\
	&\Phi_{\rm spher}(r) = -\frac{GM_{\rm spher}}{r + c}\\
	&\Phi_{\rm halo}(x,y,z) = \vhalo^2 \ln(C_1 x^2 + C_2 y^2 + C_3 xy + (z/q_z)^2 + r_h^2)
\end{align}
where $C_1$, $C_2$, and $C_3$ are combinations of the $x$ and $y$ axis
ratios ($q_1$, $q_2$) and orientation of the halo with respect to the
baryonic disk ($\phi$):
\begin{align}
  C_1 &= \frac{\cos^2\phi}{q_1^2} + \frac{\sin^2\phi}{q_2^2}\\
  C_2 &= \frac{\sin^2\phi}{q_1^2} + \frac{\cos^2\phi}{q_2^2}\\
  C_3 &= 2\sin\phi\cos\phi \left(q_1^{-2} - q_2^{-2}\right).
\end{align}
The total potential then is just
\begin{equation}
	\Phi_{\rm tot} = \Phi_{\rm disk} + \Phi_{\rm spher} + \Phi_{\rm halo}\label{eq:lm10}.
\end{equation}
Figure~\ref{fig:potential} shows equipotential slices in the Galactic X-Z plane (Y=0) and Y-Z plane (X=0) for a few choices of  $q_1$,  $q_z$, and $\phi$ while holding all other parameters fixed, as described in the figure caption.

\begin{figure}[h]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/potentials.pdf}
\caption{ Equipotential contours for the LM10 potential (Eq.~\ref{eq:lm10}) in Galactocentric, cartesian coordinates for various halo parameter choices. For all panels, $\vhalo=121.858~\mathrm{km}/\mathrm{s}$, $r_h=12~\mathrm{kpc}$. Left to right, each column represents a new choice of parameters. If not specified, other parameters are fixed to $q_1=q_2=q_z=1$ and $\phi=0^\circ$ (far left panels).  }\label{fig:potential}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/simulated_streams.png}
\caption{ Particle positions (grey dots) in Galactocentric cartesian coordinates from the final timestep of four n-body simulations with the same progenitor orbit initial conditions over a range of progenitor masses (columns). The progenitors were initialized as [TODO: DAH]. Black crosses indicate eight particles chosen from each mass simulation and used in the experiments described in Section~\ref{sec:experiments}.}\label{fig:sims}
\end{center}
\end{figure}

\section{Method}

\subsection{Tidal debris}\label{sec:debris}

For a satellite galaxy on a mildly eccentric orbit, mass-loss is driven by a combination of tidal stripping due to the steady tidal field of the parent system and tidal shocking due to the rapidly changing tidal field as the progenitor system moves through pericenter \citep[e.g.,][]{choi09}. The interplay between these two processes as a function of orbital properties will be studied in forthcoming work; we focus below on the slow disruption of stars due to steady tidal forcing. 

Consider a point-mass satellite of mass $m$ on a circular orbit with frequency $\Omega$ around a more massive mass, $M\gg m$ \citep[the ``restricted three-body problem''; e.g., \S 8.3][]{binneytremaine}. In a frame rotating with the orbital frequency of the satellite, the satellite remains fixed and the static, effective potential around the satellite has (amongst others) two stationary, unstable points located around $\sim R \pm r_J$, where $R$ is the orbital radius of the satellite and $r_J$ is the Jacobi or tidal radius,
\begin{equation}
	r_J \sim R\left(\frac{m}{3M}\right)^{1/3}.\label{eq:ptmass}
\end{equation}
Particles that would be bound to the satellite mass in isolation may have enough (Jacobi) energy to overcome the effective potential barrier at these Lagrange points (Fig.~8.6 of BT) and thus will be preferentially stripped from the satellite at these points. For a spherical, extended parent mass distribution the tidal radius instead scales with the enclosed mass at the instantaneous orbital radius, $R(t)$, with additional terms that account for the local slope of the density profile. The satellite may also be losing mass so that in general the satellite mass also depends on time. The distance scale of the debris then follows
\begin{equation}
	r_{\rm tide}(t) = R(t)\left(\frac{m(t)}{3M_{\rm enc}(R)}\right)^{1/3}\label{eq:tidalradius}
\end{equation}
where $M_{\rm enc}$ is the instantaneous enclosed mass of the parent system within orbital radius $R$.
In general, the effective Lagrange points may not be symmetric about the center of the satellite and may deviate from the tidal radius by factors of order unity. 

At pericenter, where a large fraction of the stars are unbound, the velocity of the satellite will be of order $V\sim \sqrt{GM_{\rm enc}/R}$. If the velocity dispersion of the satellite is $\sigma_v \sim \sqrt{Gm/r_J}$, then
\begin{equation}
	\sigma_v \sim V\left(\frac{m}{M_{\rm enc}}\right)^{1/3}\label{eq:velscale}.
\end{equation}
We expect the debris star velocities to also scale with $(m/M_{\rm enc})^{1/3}$. These scalings assume that the satellite is spherical with isotropic velocities; correlations amongst intra-satellite orbits from, e.g., a disk will break these assumptions. 

In a triaxial potential, the orbital plane of the satellite is not fixed but we still expect there to be \emph{effective} Lagrange points for a spherical satellite system along the line of centers connecting the origin of the parent potential to the satellite --- that is, we expect the stars to be stripped at some characteristic radius with some dispersion about this point. We proceed by defining a coordinate system relative to the position and velocity of the progenitor, ($\bs{r}_p$,$\bs{v}_p$), rotated into the instantaneous orbital plane defined by $\bs{L} = \bs{r}_p \times \bs{v}_p$. The positions are normalized by the instantaneous tidal radius (Eq.~\ref{eq:tidalradius}) and velocities are normalized by the instantaneous velocity scale (Eq.~\ref{eq:velscale}). 
The (time-dependent) basis vectors are given by
\begin{align}
	\hat{\bs{x}}_1 &= \frac{\bs{r}_p}{\|\bs{r}_p\|}\label{eq:x1}\\
	\hat{\bs{x}}_2 &= \frac{\bs{L} \times \hat{\bs{x}}_1}{\|\bs{L} \times \hat{\bs{x}}_1\|} = \hat{\bs{x}}_3 \times \hat{\bs{x}}_1\\
	\hat{\bs{x}}_3 &= \hat{\bs{L}} = \frac{\bs{L}}{\|\bs{L}\|} = \frac{\bs{r}_p \times \bs{v}_p}{\|\bs{r}_p \times \bs{v}_p\|}\label{eq:x3}.
\end{align}
%(Section~\ref{sec:sims})
Figure~\ref{fig:lpts_r} shows sections of particle orbits from the n-body simulations described above projected into this coordinate system and normalized, symmetric around their unbinding times, $\tub$, for each of the four progenitor masses. In these coordinates, the classical Lagrange points would be located at $x_1\approx\pm1,x_2\approx0,x_3\approx0$ (illustrated by the unit circle in black in Figure~\ref{fig:lpts_r}). Figure~\ref{fig:lpts_v} shows the velocity orbits of each star also projected into these coordinates and normalized. Though not centered on the point-mass Lagrange points, the location of and dispersion about the effective Lagrange points in these scaled coordinates remain remarkably consistent across the range of progenitor masses explored. Furthermore, the dispersion in velocity is well-normalized by the velocity scale of Eq.~\ref{eq:velscale}, though it is clear that the velocity dispersion along $\hat{x}_1$, the radial vector to the satellite position, is larger than that in other dimensions, possibly due to tidal shocking. 

We find that even in a triaxial potential, the phase-space dispersion of tidally stripped debris scales with the mass ratio $(m / M_{\rm enc})^{1/3}$. This motivates a model for tidal debris in which each star was ``released'' at the instantaneous, effective Lagrange point at its unbinding time, $\tub$, with some dispersion in position and velocity, all of which depend only on the mass and orbit of the progenitor and the parent potential. We present this model in detail below.

\begin{figure}[h]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/Lpts_r.png}
\caption{ Orbits of 2000 randomly drawn particles projected into the instantaneous orbital plane coordinates (Eqs.~\ref{eq:x1}-\ref{eq:x3}), normalized by the tidal radius (Eq.~\ref{eq:tidalradius}), and only shown within half a satellite crossing time around $t=\tub$ for each of the four progenitor masses. The orbits were integrated backwards from their present-day positions (final time step of the n-body simulations) as test particles without the potential of the progenitor. Horizontal black line shows $x_2=0$ (top panels) and $x_3=0$ (bottom panels), and the unit circle (black circle) shows the classical disruption radius in these coordinates. }\label{fig:lpts_r}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/Lpts_v.png}
\caption{ Same as Figure~\ref{fig:lpts_r} but for particle velocities normalized by the velocity scale (Eq.~\ref{eq:velscale}). }\label{fig:lpts_v}
\end{center}
\end{figure}

%\begin{figure}[h]
%\begin{center}
%\includegraphics[width=\textwidth]{../../plots/paper2/num_recombine.png}
%\caption{ TODO }\label{fig:R_V}
%\end{center}
%\end{figure}

\subsection{Probabilistic model (\rewinder)}
We observe the 6D position of a star, $\D$, in heliocentric coordinates --- e.g., the measured position on the sky, ($l$, $b$); distance, $d$; proper motions, ($\mu_l$, $\mu_b$); and line-of-sight velocity, $v_r$ --- and have determined through some other means that this star was once part of a progenitor system (e.g., satellite galaxy) with mass $m(t)$ that is disrupting and forming a cold debris structure in the potential, $\Phi$, of the parent galaxy (e.g., the Milky Way). We assume that the mass of the parent system enclosed within the pericenter of the orbit of the satellite, $M_{\rm enc}(R_{\rm peri})$, is much larger than the initial mass of the satellite, $M_{\rm enc}(R_{\rm peri})\gg m(t=0)$. The present position of the progenitor is observed to be at heliocentric position $\D_\sat$ (where any subscript $\sat$ refers to the progenitor). In general, the data for the star and progenitor will have missing dimensions and significant uncertainties at distances typical to the Galactic halo, thus we define $\W$ and $\W_\sat$ as the true 6D, heliocentric positions of the star and progenitor and will include these in our model. By including these positions in the model, this model will work even when the star has missing dimensions or the progenitor location is unknown as in, e.g., the Orphan stream \citep{belokurov07}.

We assume that the observational uncertainties are Gaussian in heliocentric, spherical coordinates, such that
\begin{align}
	p(\D \given \W) &= \mathcal{N}(\D \given \W, \bSigma)\label{eq:obsstar}\\
	p(\D_\sat \given \W_\sat) &= \mathcal{N}(\D_\sat \given \W_\sat, \bSigma_\sat)\label{eq:obsprog}
\end{align}
where $\mathcal{N}$ represents the normal distribution, and the covariance matrices $\bSigma$ and $\bSigma_\sat$ specify the observational uncertainties on the observed 6D position of the star and progenitor, respectively. 

To model the true, 6D, present-day position of the star, $\W$, we first transform to cartesian, Galactocentric coordinates where ($\bs{r},\bs{v}$) and ($\bs{r}_\sat,\bs{v}_\sat$) are the position and velocity of the star and progenitor. In cartesian coordinates, the present-day position of the star is taken as having been sampled at $t=\tub$ from an isotropic Gaussian centered on one of the instantaneous, effective Lagrange points in position, and an isotropic Gaussian centered on the origin in velocity, evolved to present day in the parent potential, $\Phi$, parametrized by the parameter vector $\bs{\Theta}_\Phi$. We assume that once the star becomes ``unbound'' from the satellite the potential of the satellite can be ignored, and thus treat the star as a test particle.\footnote{This assumption breaks down for sufficiently large-mass progenitors, somewhere between $\sim10^8-10^9~$M$_\odot$.} The satellite mass enters the model through the tidal radius; a changing satellite mass will skew the positions of the effective Lagrange points and velocity scale. We allow for mass-loss by incorporating the initial satellite mass, $m_0$, and a constant mass-loss term, $\dot{m}$ into the model: $m(t) = m_0 - \dot{m}t$. Finally, we add two additional parameters: a constant, global offset, $\Loffset$, that scales the position of the effective Lagrange points relative to the classical tidal radius, and a binary parameter $\tailbit$, that is either $-1$ or $+1$ depending on whether the star is in the leading or trailing tail. To compress notation, we pack all progenitor parameters ($\W_\sat, m_0, \dot{m}, \Loffset$) into the vector $\bs{\Theta}_\sat$, and all star parameters ($\W, \tailbit, \tub$) into the vector $\bs{\Theta}$. The likelihood is then:
\begin{align}
	p(\bs{\Theta} \given \bs{\Theta}_\sat, \bs{\Theta}_\Phi) &= p(\bs{r} \given \bs{\Theta}_\sat, \bs{\Theta}_\Phi)\,p(\bs{v} \given\bs{\Theta}_\sat, \bs{\Theta}_\Phi)\,\left\vert\J\right\vert_{t=\tub}\label{eq:starlike}\\
	p(\bs{r} \given \bs{\Theta}_\sat, \bs{\Theta}_\Phi) &= \mathcal{N}(\bs{r} \given \bs{r}_\sat - \Loffset\,\tailbit\,\rtide\,\hat{x}_1, \rtide^2)_{t=\tub}\\
	p(\bs{v} \given \bs{\Theta}_\sat, \bs{\Theta}_\Phi) &= \mathcal{N}(\bs{v} \given \bs{v}_\sat, \sigma^2_v)_{t=\tub}
\end{align}
%\begin{align}
%	p(\W \given \W_\sat, m_0, \dot{m}, \tub, \Phi, \Loffset, \tailbit) &= p(\bs{r} \given \bs{r}_\sat, m_0, \dot{m}, \tub, \Phi, \Loffset, \tailbit)\,p(\bs{v} \given \bs{v}_\sat, m_0, \dot{m}, \tub, \Phi)\,\left\vert\J\right\vert_{t=\tub}\\
%	p(\bs{r} \given \bs{r}_\sat, m_0, \dot{m}, \tub, \Phi, \Loffset, \tailbit) &= \mathcal{N}(\bs{r} \given \bs{r}_\sat - \Loffset\,\tailbit\,\rtide\,\hat{x}_1, \rtide^2)_{t=\tub}\\
%	p(\bs{v} \given \bs{v}_\sat, m_0, \dot{m}, \tub, \Phi) &= \mathcal{N}(\bs{v} \given \bs{v}_\sat, \sigma^2_v)_{t=\tub}
%\end{align}
where $\rtide$ is given by Eq.~\ref{eq:tidalradius}, and $\sigma_v$ by Eq.~\ref{eq:velscale}. $\left\vert\J\right\vert$ is the absolute value of the determinant of the Jacobian that defines the transformation from heliocentric, spherical to Galactocentric, cartesian coordinates. For a single star, in detail, the model works as follows:
\begin{enumerate}
	\item sample from observed distributions over the heliocentric positions (Eqs.~\ref{eq:obsstar},\ref{eq:obsprog}), or priors if positions are unknown, for the star and progenitor;
	\item transform star and progenitor positions in heliocentric coordinates to Galactocentric, cartesian coordinates;
	\item integrate both orbits backwards (as test particles) for the total interaction time, $t_{\rm int}\approx6$~Gyr;
	\item at the timestep closest to $\tub$, transform the particle position to the relative, normalized coordinates defined in Section~\ref{sec:debris};
	\item evaluate the likelihood according to which tail the star belongs to, $\tailbit$, (Eq.~\ref{eq:starlike}).
\end{enumerate}
Assuming each star is an independent tracer, the full posterior for many stars is then just the product of the individual likelihoods with the priors:
%\begin{multline}
%	p(\Phi, \{\W^{(i)}\}, \W_\sat, m_0, \dot{m}, \tub, \Loffset, \tailbit, \given \{\D^{(i)}\}, \D_\sat) = \\
%		\shoveleft{\hspace{1em}\frac{1}{\mathcal{Z}} \, \prod_i \, p(\D^{(i)} \given \W^{(i)}) \, p(\D_\sat \given \W_\sat)}\\
%			\times p(\W^{(i)} \given \W_\sat, m_0, \dot{m}, \tub^{(i)}, \Phi, \Loffset, \tailbit^{(i)}) \, 
%			\, p(\tub^{(i)}) \, p(\Phi) \, p(\Loffset)
%\end{multline}
\begin{multline}
	p(\{\bs{\Theta}^{(i)}\}, \bs{\Theta}_\sat, \bs{\Theta}_\Phi \given \{\D^{(i)}\}, \D_\sat) = \\
		\frac{1}{\mathcal{Z}} \, \prod_i \, p(\D^{(i)} \given \W^{(i)}) \, p(\D_\sat \given \W_\sat)\,
			p(\bs{\Theta}^{(i)} \given \bs{\Theta}_\sat, \bs{\Theta}_\Phi) \, 
			p(\bs{\Theta}) \, p(\bs{\Theta}_\sat)\,p(\bs{\Theta}_\Phi)
\end{multline}
All parameters are summarized in Table~\ref{tbl:params}. 

This model works well when all stars are lost due to tidal pruning. Even on a mildly eccentric orbit, stars are preferentially stripped around the satellite's pericenter because of tidal shocking. We will explore properly modeling this process in future work. 

%For this article, we modify the above to be a mixture model: we add a new parameter for each star, $\pshock$, which is the probability that the star is drawn from a broader, ``shocked'' distribution instead of a tight Gaussian centered on an effective Lagrange point:
%\begin{multline}
%	p_{\rm strip} = [ \mathcal{N}(\bs{r} \given \bs{r}_\sat - \Loffset\,\tailbit\,\rtide\,\hat{x}_1, \sigma^2_r)\\
%		\times \mathcal{N}(\bs{v} \given \bs{v}_\sat, \sigma^2_v) \left\vert\J\right\vert ]_{t=\tub}
%\end{multline}
%\begin{align}
%	p_{\rm shock} = \left [ \mathcal{N}(\bs{r} \given \bs{r}_\sat, 10\sigma^2_r)\mathcal{N}(\bs{v} \given \bs{v}_\sat, 10\sigma^2_v) \left\vert\J\right\vert\right]_{t=\tub}
%\end{align}
%\begin{multline}
%	p(\W \given \W_\sat, \tub, \Phi, \Loffset, \tailbit, \pshock) = \\
%		\pshock p_{\rm shock} + (1-\pshock)p_{\rm strip}.
%\end{multline}
%Here we assume that the ``shocked'' distribution has a much larger variance, and arbitrarily set this to 10 times the variance of the stripped debris. The posterior probability for the position of a star, progenitor, and properties of the parent potential, given the data, is then
%\begin{multline}
%	p(\Phi, \W, \W_\sat, \tub, \Loffset, \tailbit, \pshock \given \D, \D_\sat) = \\
%		\shoveleft{\hspace{3em}\frac{1}{\mathcal{Z}} \, p(\D \given \W) \, p(\D_\sat \given \W_\sat)}\\
%			\times p(\W \given \W_\sat, \tub, \Phi, \Loffset, \tailbit, \pshock) \, 
%			p(\Phi) \, p(\tub) \, p(\Loffset)
%\end{multline}
%where the factor $\mathcal{Z}$ only depends on the properties of the data (the \emph{evidence}), and is thus constant when varying the model parameters. All model parameters are summarized in Table~\ref{tbl:params}. Assuming each star is an independent tracer, the full posterior for many stars is then just the product of the individual likelihoods with the priors:
%\begin{multline}
%	p(\Phi, \W, \W_\sat, \tub, \Loffset, \tailbit, \pshock \given \D, \D_\sat) = \\
%		\shoveleft{\hspace{1em}\frac{1}{\mathcal{Z}} \, \prod_i \, p(\D^{(i)} \given \W^{(i)}) \, p(\D_\sat \given \W_\sat)}\\
%			\times p(\W^{(i)} \given \W_\sat, \tub^{(i)}, \Phi, \Loffset, \tailbit^{(i)}, \pshock^{(i)}) \, 
%			\, p(\tub^{(i)}) p(\Phi) \, p(\Loffset)
%\end{multline}

\section{Experiments} \label{sec:experiments}
In what follows, we use \rewinder\, to model ``observations'' of the n-body simulations described in Section~\ref{sec:sims}. For all tests in this article, we model the potential of the parent galaxy with the same functional form used in the simulations (Equation~\ref{eq:lm10}) --- we stress that the data are generated with n-body simulations and are not generated with anything resembling the likelihood function presented above. When recovering the potential, we hold fixed the disk and spheroid parameters (see Table~\ref{tbl:params}), along with two halo parameters: the scale radius, $r_h$, and one of the flattening components in the x-y plane, $q_2$. These halo parameters are degenerate with combinations of the other parameters --- e.g., setting $q_1=2.0$, $q_2=1.0$, $\phi=0^\circ$ is equivalent to setting $q_1=1.0$, $q_2=2.0$, $\phi=90^\circ$. The priors on the remaining halo parameters are taken to be uniform over a conservative domain of realistic values: for $\vhalo$, 100-200~km/s corresponds to a range in solar circular velocities from $\sim$210-250 km/s (holding other parameters fixed); the range in axis ratios allow for prolate, oblate, and generic triaxiality; and $\phi$ is restricted to $\pm45^\circ$ around the true simulation value, $\phi = 97^\circ$.

For all experiments below, we use a Markov Chain Monte Carlo (MCMC) algorithm to sample from the posterior probability distribution given by our model. Standard MCMC algorithms (e.g., Metropolis-Hastings) update a single chain while exploring parameter space. We instead use an affine-invariant ``ensemble'' sampler \citep{goodman10} that, each step in parameter space, updates the positions of many ``walkers'' (the ensemble). This algorithm is implemented in the \project{Python} programming language \citep{foremanmackey13} and runs naturally in a parallelized environment, e.g., the message passing interface (MPI). In each experiment we run the walkers for a large number of steps from starting positions described below, then throw away these samples and take the positions from the final step of this ``burn-in'' phase as a starting point for the samples used for inference. We compute the autocorrelation time for each sampled parameter (using \texttt{ACOR}\footnote{www.math.nyu.edu/faculty/goodman/software/acor/}$^{,}$\footnote{https://github.com/dfm/acor}) and thin the chains by taking every $\mathrm{median}(t_{\rm acor})$ sample to ensure the samples are close to independent.

\begin{table}[h]
\begin{center}
	\begin{tabular}{l c l} \toprule
		\multicolumn{3}{l}{{\bf \emph{Milky Way parameters} ($\bs{\Theta}_\Phi$)}} \\
		\toprule
		Component & Parameter & Prior \\\toprule
		disk & $M_{\rm disk}$ & $1.0\times10^{11}M_\odot$ (fixed) \\ 
		& $a$ & 6.5 kpc (fixed)\\
		& $b$ & 0.26 kpc (fixed)\\
		\midrule
		spheroid & $M_{\rm spher}$ & $3.4\times10^{10}M_\odot$ (fixed)\\ 
		& $c$ & 0.7 kpc (fixed)\\
		\midrule
		halo & $\vhalo$ & $\mathcal{U}(100,200)$ km/s \\
		& $q_1$ & $\mathcal{U}(1,2)$\\
		& $q_2$ & 1.0 (fixed)\\
		& $q_z$ & $\mathcal{U}(1,2)$\\
		& $\phi$ & $\mathcal{U}(52,142)$ deg\\
		& $r_h$ & 12 kpc (fixed)\\
		\toprule
		\multicolumn{3}{l}{{\bf \emph{Progenitor parameters} ($\bs{\Theta}_\sat$)}} \\
		\toprule
		position & $\bs{r}_\sat$ & $\|\bs{r}_\sat\|\sim\mathcal{U}(0,200)$~kpc \\
		velocity & $\bs{v}_\sat$ & $\|\bs{v}_\sat\|\sim\mathcal{N}(\mu=0,\sigma^2=4000)$~km/s\\
		Lagrange pt. offset & $\alpha$ & $\mathcal{N}(\mu=2,\sigma^2=1)$\\
		\toprule
		\multicolumn{3}{l}{{\bf \emph{Star parameters} ($\bs{\Theta}^{(i)}$)}} \\
		\toprule
		position & $\bs{r}$ & $\|\bs{r}\|\sim\mathcal{U}(0,200)$~kpc \\
		velocity & $\bs{v}$ & $\|\bs{v}\|\sim\mathcal{N}(\mu=0,\sigma^2=4000)$~km/s\\
		tail assignment (binary) & $\beta$ & $\pm1$~equally likely\\ % TODO: how to say equal weight to -1 or 1?
%		prob. shocked & $\pshock$ & $\mathcal{U}(0,1)$\\
		time unbound & $\tub$ & $\mathcal{U}(0,\tint)$\\ % TODO: talk about \tint (integration time) in text!
		\bottomrule
		\end{tabular}
	\caption{Parameter values used ...\label{tbl:params}}
\end{center}
\end{table}
% TODO: in caption, redefine N is normal U is uniform. Star parameters are repeated for each star. summarize number of parameters for milky way, progenitor, etc. -- how to read the parameter

\subsection{Data with negligible uncertainties}\label{sec:exp1}

We first test the model using eight particles (stars) --- four from the leading tail, and four from the trailing tail --- randomly sampled from the $2.5\times10^8~M_\odot$ simulation (Section~\ref{sec:sims}), assuming the observed 6D positions for both the stars and the progenitor have negligible uncertainties. The stars were required to have been stripped after the first pericentric passage and have a present-day distance within $50$ kpc of the Sun. Figure~\ref{fig:sims} (second column from right) shows the eight randomly chosen stars (black crosses) in Galactic coordinates, over-plotted on all other simulated particles (grey points). 

We leave the potential parameters ($q_1,q_z,\phi,\vhalo$) free to vary, along with the Lagrange point offset, $\Loffset$, and initialize an ensemble of 64 MCMC walkers by sampling from the priors summarized in Table~\ref{tbl:params}. We run the walkers for 10000 steps to burn-in, then restart the sampler starting from the final position of the burn-in phase and run for another 5000 inference steps. Figure~\ref{fig:trace} shows the walker positions over the 5000 inference steps for each of the five parameters. The autocorrelation time for each parameter is displayed on its corresponding panel. Figure~\ref{fig:exp1_posterior} shows projections of the posterior probability distribution for the parameters; with perfect data, the uncertainties on the potential parameters are all $<1\%$.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.9\textwidth]{../../plots/paper2/mcmc_trace.png}
\caption{ Positions of all 64 MCMC walkers (see Section~\ref{sec:experiments}) for each parameter at each step of the inference (black lines). Horizontal green lines show the input values of the potential parameters (\potp). The MCMC chains do not display any bulk movement or stray walkers, implying, by eye, that the chains have converged. Projections of the sample densities are shown in Figure~\ref{fig:exp1_posterior}. }\label{fig:trace}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp1_posterior.png}
\caption{ Projections of the posterior probability distribution over the four potential parameters (\potp) and Lagrange point offset ($\alpha$) assuming negligible uncertainties on the observed phase-space coordinates of eight stars and the progenitor, visualized as two-dimensional histograms of MCMC samples. Solid contours (black lines) show approximately 1$\sigma$ and 2$\sigma$ levels of the distribution. Vertical and horizontal lines (blue) show the true, input values for the potential parameters used in the n-body simulations. For the potential parameters, the axis ranges were chosen to be $\pm$5\% around the true values. Note that any biases in the inferred values are $\lesssim1\%$. }\label{fig:exp1_posterior}
\end{center}
\end{figure}

\subsection{Data with near-future uncertainties}\label{sec:exp2}
We next take the same eight stars used in the previous experiment and ``observe'' them with optimistic observational uncertainties. We take these stars to be RR Lyrae variables which are known to be excellent distance indicators via the mid-infrared period-luminosity relation \citep[as shown in, e.g.,][]{madore12}. Nearly 100 RR Lyrae associated with the Sgr stream and $\sim$30 associated with the Orphan stream will be observed with \spitzer as part of the SMASH survey \citep{smashprop} with expected fractional distance uncertainties around $\sim$2\%. These stars will also be included in the \gaia\, proper motion catalog: at a distance of $\sim$50~kpc, a typical RR Lyrae will have a tangential velocity error around $\sim$20~km/s.

For this experiment, we (1) assume the stars are bright distance indicators --- RR Lyrae --- such that the fractional distance uncertainty is $2\%$; (2) neglect the uncertainty in angular position (for a typical RR Lyrae at 50~kpc this is $\sim$$10^{-7}$~deg for \gaia); (3) assume we can measure radial velocities to these stars with 5~km/s uncertainty; and (4) compute the sky-averaged \gaia\, proper-motion uncertainty for each star assuming an F0V spectral type using the \texttt{PyGaia}\footnote{https://github.com/agabrown/PyGaia} code and use this uncertainty for both components of proper motion. We further assume that we know the tail assignment for each star, $\beta$. We observe the position of the progenitor with the same observational uncertainties, though in reality some coordinates will have higher or lower uncertainties.

This experiment samples over the four potential parameters, the Lagrange point offset, four phase-space coordinate parameters plus the unbinding time for each star (40 total), and four phase-space coordinate parameters for the progenitor --- 49 parameters in total. We use an ensemble of 256 walkers and draw initial conditions for the coordinate parameters by sampling from Gaussian's centered on the ``observed'' value with variances specified by the observational uncertainties. Other parameters --- potential parameters, $\Loffset$, and $\tub$ --- are initialized by drawing from the priors summarized in Table~\ref{tbl:params}. We burn in the walkers for 10000 steps and run for 10000 inference steps. Figures~\ref{fig:exp2_potential}, \ref{fig:exp2_satellite}, \ref{fig:exp2_particle} show the marginalized posteriors for the potential parameters, satellite parameters, and parameters for a single particle. 

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp2_potential.png}
\caption{ Projections of the marginal posterior over the triaxial potential parameters for observed stars and progenitor with near-future uncertainties (Section~\ref{sec:exp2}). Axis ranges show the lower and upper bounds on the uniform priors over these parameters. }\label{fig:exp2_potential}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp2_satellite.png}
\caption{ Projections of the marginal posterior over the progenitor parameters for observed stars and progenitor with near-future uncertainties (Section~\ref{sec:exp2}). }\label{fig:exp2_satellite}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp2_particle.png}
\caption{ Projections of the marginal posterior over parameters for one of the stars for observed stars and progenitor with near-future uncertainties (Section~\ref{sec:exp2}).   }\label{fig:exp2_particle}
\end{center}
\end{figure}

\subsection{Precise distance measurements with missing proper motions}\label{sec:exp3}
The SMASH survey \citep{smashprop} will be completed in 2014, long before the final \gaia\, data release. Thus, we will soon have precise distance measurements for stars in the Sgr and Orphan streams, but poor proper motion constraints. SMASH also targets several RR Lyrae in the Sgr core, which enable a high-precision distance measurement of the progenitor. Though proper motions have been measured for the Sgr progenitor, we now consider a case in which we have high-precision (2\%) distances to stream stars and the progenitor, 10~km/s radial velocity uncertainty, and missing proper motions for all stars and progenitor. 

As with the previous experiment, this experiment includes 49 model parameters in total. We again use an ensemble of 256 walkers, but this time initialize the walkers by sampling the coordinate parameters from Gaussians centered on the true positions with variances set to 1\% of the parameter values. Other parameters --- potential parameters, $\Loffset$, and $\tub$ --- are initialized by drawing from the priors summarized in Table~\ref{tbl:params}. We again burn in the walkers for 10000 steps and run for 10000 inference steps. Figures~\ref{fig:exp3_potential}, \ref{fig:exp3_satellite}, \ref{fig:exp3_particle} show the marginalized posteriors for the potential parameters, satellite parameters, and parameters for a single particle. Accounting for observational uncertainties does increase the uncertainties in the constraints on the potential parameters (as expected), but this demonstrates that a small sample of well-measured stream stars provide an enormous amount of information about the triaxiality of the potential.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp3_potential.png}
\caption{ Same as Figure~\ref{fig:exp2_potential} but for data with no proper motion measurements. }\label{fig:exp3_potential}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp3_satellite.png}
\caption{ Same as Figure~\ref{fig:exp2_satellite} but for data with no proper motion measurements.  }\label{fig:exp3_satellite}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp3_particle.png}
\caption{ Same as Figure~\ref{fig:exp2_particle} but for data with no proper motion measurements.  }\label{fig:exp3_particle}
\end{center}
\end{figure}

\subsection{Precise distance measurements of stars with no observed progenitor}
Most of the streams and debris structures discovered thus far have undetected or unconfirmed progenitors. We expect the phase-space positions of the stars to provide constraints on the position of the progenitor even if it is unobserved. For this experiment, we consider a situation where we have precise (2\%) distance measurements, 10~km/s radial velocity uncertainties, and no proper motion measurements to eight stream stars (the same used in previous experiments), and no knowledge of the 6D position of the progenitor object. 

Figures~\ref{fig:exp4_potential}, \ref{fig:exp4_satellite}, \ref{fig:exp4_particle} show the marginalized posteriors for the potential parameters, satellite parameters, and parameters for a single particle.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp4_potential.png}
\caption{Same as Figure~\ref{fig:exp2_potential} but with no a priori knowledge of the 6D position of the progenitor.}\label{fig:exp4_potential}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp4_satellite.png}
\caption{ Same as Figure~\ref{fig:exp2_satellite} but with no a priori knowledge of the 6D position of the progenitor.}\label{fig:exp4_satellite}
\end{center}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{../../plots/paper2/exp4_particle.png}
\caption{ Same as Figure~\ref{fig:exp2_particle} but with no a priori knowledge of the 6D position of the progenitor.}\label{fig:exp4_particle}
\end{center}
\end{figure}

\section{Discussion}
\rewinder\, addresses each of the issues identified with other stream modeling methods: 
\begin{enumerate}
	\item The true 6D positions of stars and the progenitor are included as parameters in the model and thus observational uncertainties and missing data dimensions are naturally incorporated in the inferences.
	\item The orbits of the stars are directly integrated and only require a function that evaluates the acceleration due to the potential at any given time and position. In this article we only consider one parametrized model for the potential but [...]
	\item Incorporating multiple streams only requires multiplying likelihoods.
	\item The inference is much faster than full n-body modeling because the orbits of the stars and progenitor are integrated as test particles.
\end{enumerate}

% Our method also naturally extends to using multiple debris structures \citep[see][who illustrate the power of using multiple streams to simultaneously constrain the potential]{deg14}.

Although the \gaia\, project will deliver hundreds of millions of stars useful for dynamical inference,
  it still might be that the most relevant stellar samples for inferring the Milky Way potential might be very small in the end.
For instance, stars that produce good distance estimates might be much more valuable than typical stars in the sample.
At halo distances, \gaia's parallaxes are not expected to be better than the distance indicators produced by the best
  variable stars observed at the best wavelengths; for example, near-infrared observations of RR Lyrae stars
  can in principle deliver $\sim$2\% percent photometric distances at essentially all halo distances \citep{madore12}.
These valuable stars are rare (and their abundances are age and metallicity dependent);
  there could be many cold structures in the Milky Way halo that are highly constraining
  on the potential in principle, but which contain only a few good distance-indicating members.
That said, it is not yet known what the trade-offs are between having many stars at low precision and a few at high precision,
  nor is it known how valuable distance information really is, when a structure contains many precisely observed members.

Another reason to think about small samples is more conceptual:
in dynamical inferences that go beyond simple virial or Jeans arguments,
  inference depends on the non-linear dynamical evolution of populations in phase space.
The nonlinearities, combined with heteroskedastic data and requirements to marginalize over phase-space distribution functions,
  lead naturally to situations in which some stars are \emph{far more informative} than others.
For a simple example, in a toy study of the Solar System,
  phase-space distribution marginalization was shown to make some planets are far more informative than others
  about the gravitational potential \citep{bovy10}.
This is expected to be a generic feature in dynamical problems:
  it might be that a very small fraction of \gaia's catalog entries
  deliver a large fraction of the information about the Milky Way's potential and formation history.

[Cold vs. Hot streams]

[bow-tie structure, Kuepper work, and so on]

[What's unrealistic about what we have done?  The kinematic model of
  the progenitor is exceedingly simplistic; why are we okay with it
  nonetheless but what could we do to improve it?  Related to this,
  the progenitor doesn't shrink with time (as it should).  What's up
  with that?]

[We did not assume the potential is static in time.  At least not in
  general; nothing in the method requires or suggests this.]

[Issues about computation and scaling.]

[Nothing special about streams; will work on any structures, including
  shells and the like.]

[Different streams will constraint different properties of the potential -- multiple streams are crucial. Here we use a stream roughly in the X-Z plane, thus we expect it to be more sensitive to flattening in Z direction]

[Don't eschew low-dimensional constraints on the potential!]

[Another prediction of hierarchical structure formation in $\Lambda$CDM is the presence of substructure. In principle, this method would work on any potential that we can integrate orbits in.]

[Haven't explored parameter space...]
For experiments in this article with realistic uncertainties we have not performed a search in parameter space for the optimal values, and instead started the MCMC walkers with a small dispersion around the true parameter values.

[Computational...]
Each step in parameter space with \rewinder\, requires integrating the orbits of stars and the progenitor: we presently integrate with a fixed timestep using leapfrog integration. Computing the acceleration due to the given potential at each step is implemented in \project{Cython} (and approaches \project{ANSI-C}-like speed), but the rest of the code is written in pure-\project{Python}. Though already significantly less computationally intensive than running a full n-body simulation for every parameter step, running each MCMC walker for 10000 steps requires parallelization and a few hours of CPU time on a compute cluster. Further optimization of the integration method (e.g., using an adaptive method or implementing in \project{Cython}) could speed up the inference significantly.

\section{Conclusions}
We have presented a probabilistic model (\rewinder) --- a likelihood function and with priors on the parameters --- for using stars observed in tidal streams to constrain properties of any underlying gravitational potential. \rewinder\, relies on direct orbit integration and not on computing conserved quantities (e.g., actions) and can thus be used with arbitrarily complex (e.g., time-dependent or clumpy) forms of the potential. We have performed several experiments to show that \rewinder\, simultaneously constrains the potential and models the stream given simulated data with a range of realistic uncertainties. 

\acknowledgements
We thank Anthony Brown (Leiden) for insight on the \gaia\, data quality and for providing the open source \texttt{PyGaia} code for computing predicted uncertainties. We thank the organizers of the Gaia Challenge (2013) and the University of Surrey for hospitality during this workshop. We thank Hans-Walter Rix (MPIA) and Jo Bovy (IAS) for ... [TODO: HOGG].
APW is supported by a National Science Foundation Graduate Research Fellowship under Grant No.\ 11-44155. This work was supported in part by the National Science Foundation under Grant No. PHYS-1066293. 
DWH was partially supported by NASA (Grant NNX12AI50G) and the NSF (Grant IIS-1124794).
This research made use of Astropy, a community-developed core Python package for Astronomy \citep{astropy13}.
This work additionally relied on Columbia University's \emph{hotfoot} and \emph{yeti} compute clusters, and we acknowledge the Columbia HPC support staff for assistance. \\

\bibliographystyle{apj}
\bibliography{refs}

\end{document}
